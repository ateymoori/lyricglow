<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' https: data:">
  <title>Now Playing</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="player-widget">
    <div class="header-buttons">
      <button class="btn-settings" id="settingsBtn">⚙</button>
      <button class="btn-close" id="closeBtn">×</button>
    </div>

      <div class="player-content" data-section="player">
      <img class="album-art" id="albumArt" alt="">

      <div class="track-info">
        <div class="track-main">
          <div class="track-title" id="title">Waiting for music...</div>
          <div class="track-artist" id="artist"></div>
          <div class="track-album" id="album"></div>
        </div>

        <div class="track-metadata">
          <div class="detail-row">
            <span class="detail-item" id="year"></span>
            <span class="detail-item" id="genre"></span>
            <span class="detail-item" id="bpm"></span>
          </div>
          <div class="detail-row">
            <span class="detail-item" id="playCount"></span>
            <span class="detail-item" id="rating"></span>
          </div>
        </div>

        <div class="playback-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
          </div>
          <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
          </div>
        </div>

        <div class="media-controls">
          <button class="control-btn" id="previousBtn" title="Previous track">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M3.3 1a.7.7 0 0 1 .7.7v5.15l9.95-5.744a.7.7 0 0 1 1.05.606v12.575a.7.7 0 0 1-1.05.607L4 9.149V14.3a.7.7 0 0 1-.7.7H1.7a.7.7 0 0 1-.7-.7V1.7a.7.7 0 0 1 .7-.7h1.6z"/>
            </svg>
          </button>
          <button class="control-btn control-btn-play" id="playPauseBtn" title="Play/Pause">
            <svg class="play-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M3 1.713a.7.7 0 0 1 1.05-.607l10.89 6.288a.7.7 0 0 1 0 1.212L4.05 14.894A.7.7 0 0 1 3 14.288V1.713z"/>
            </svg>
            <svg class="pause-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="display: none;">
              <path d="M2.7 1a.7.7 0 0 0-.7.7v12.6a.7.7 0 0 0 .7.7h2.6a.7.7 0 0 0 .7-.7V1.7a.7.7 0 0 0-.7-.7H2.7zm8 0a.7.7 0 0 0-.7.7v12.6a.7.7 0 0 0 .7.7h2.6a.7.7 0 0 0 .7-.7V1.7a.7.7 0 0 0-.7-.7h-2.6z"/>
            </svg>
          </button>
          <button class="control-btn" id="nextBtn" title="Next track">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M12.7 1a.7.7 0 0 0-.7.7v5.15L2.05 1.107A.7.7 0 0 0 1 1.712v12.575a.7.7 0 0 0 1.05.607L12 9.149V14.3a.7.7 0 0 0 .7.7h1.6a.7.7 0 0 0 .7-.7V1.7a.7.7 0 0 0-.7-.7h-1.6z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="lyrics-container" id="lyricsContainer" data-section="lyrics">
      <div class="lyrics-line lyrics-previous" id="lyricsPrevious"></div>
      <div class="lyrics-line lyrics-current" id="lyricsCurrent">
        <span class="lyrics-text"></span>
      </div>
      <div class="lyrics-line lyrics-next" id="lyricsNext"></div>
    </div>

    <div class="metadata-container" id="metadataContainer">
      <div class="artist-images-carousel" id="artistImagesCarousel" data-section="images">
        <div class="carousel-track" id="carouselTrack"></div>
        <button class="carousel-nav carousel-prev" id="carouselPrev">‹</button>
        <button class="carousel-nav carousel-next" id="carouselNext">›</button>
      </div>

      <div data-section="info">
        <div class="artist-info" id="artistInfo">
          <span class="info-item" id="artistAlternateName"></span>
          <span class="info-item" id="artistCountry"></span>
          <span class="info-item" id="artistBornYear"></span>
          <span class="info-item" id="artistDiedYear"></span>
          <span class="info-item" id="artistGenre"></span>
        </div>

        <div class="artist-links" id="artistLinks">
          <a class="link-item" id="artistWebsite" target="_blank"></a>
          <a class="link-item" id="artistFacebook" target="_blank"></a>
          <a class="link-item" id="artistTwitter" target="_blank"></a>
        </div>

        <div class="metadata-stats" id="metadataStats">
          <span class="stat-item" id="artistListeners"></span>
          <span class="stat-item" id="artistPlaycount"></span>
          <span class="stat-item" id="trackPlaycount"></span>
          <a class="stat-item" id="artistProfile" target="_blank"></a>
        </div>

        <div class="metadata-tags" id="metadataTags"></div>
      </div>

      <div class="metadata-bio" id="metadataBio" data-section="bio">
        <div class="bio-summary" id="bioSummary"></div>
        <button class="bio-expand" id="bioExpand">Show more</button>
      </div>

      <div class="top-tracks-section" id="topTracksSection" data-section="tracks">
        <h3 class="section-title">Popular Tracks</h3>
        <div class="top-tracks-list" id="topTracksList"></div>
      </div>

      <div class="top-albums-section" id="topAlbumsSection" data-section="albums">
        <h3 class="section-title">Top Albums</h3>
        <div class="top-albums-grid" id="topAlbumsGrid"></div>
      </div>

      <div class="metadata-similar" id="metadataSimilar" data-section="similar">
        <span class="similar-label">Similar artists:</span>
        <div class="similar-artists" id="similarArtists"></div>
      </div>
    </div>
  </div>

  <div class="image-modal" id="imageModal">
    <div class="modal-content">
      <img class="modal-image" id="modalImage" alt="">
      <button class="modal-close" id="modalClose">×</button>
      <button class="modal-download" id="modalDownload">Download</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal">
    <div class="settings-content">
      <div class="settings-header">
        <h2>Settings</h2>
        <button class="modal-close" id="settingsClose">×</button>
      </div>

      <div class="settings-main">
        <div class="settings-sidebar">
          <button class="settings-tab active" data-tab="general">General</button>
          <button class="settings-tab" data-tab="appearance">Display</button>
          <button class="settings-tab" data-tab="storage">Cache</button>
        </div>

        <div class="settings-body">
        <!-- General Tab -->
        <div class="settings-section" id="tab-general">
          <div class="settings-card">
            <h3>Launch Settings</h3>
            <div class="settings-group">
              <label class="setting-row">
                <input type="checkbox" id="settings-launch-at-login">
                <span class="checkbox-custom"></span>
                <div class="setting-content">
                  <span class="setting-label">Launch at Login</span>
                  <span class="setting-description">Start automatically when you log in</span>
                </div>
              </label>
            </div>
          </div>

          <div class="settings-card">
            <h3>Spotify Integration</h3>
            <p class="settings-description">Connect your Spotify account to view top tracks and albums</p>
            
            <div id="spotifyLoggedOut" class="spotify-auth-card">
              <div class="spotify-empty-state">
                <div class="spotify-empty-icon">♫</div>
                <p class="spotify-empty-text">Connect your Spotify account to unlock top tracks and albums</p>
              </div>
              <button class="btn-primary btn-spotify" id="spotifyLoginBtn">
                Login with Spotify
              </button>
              <div class="spotify-status-footer">
                <div class="status-indicator offline">Not connected</div>
              </div>
            </div>

            <div id="spotifyLoggedIn" class="spotify-auth-card" style="display: none;">
              <div class="user-profile">
                <img class="user-avatar" id="userAvatar" src="" alt="User Avatar" style="display: none;">
                <div class="user-details">
                  <p class="user-name" id="userName"></p>
                  <p class="user-email" id="userEmail"></p>
                </div>
              </div>
              <div class="spotify-status-footer">
                <div class="status-indicator online">Connected</div>
                <button class="btn-link" id="spotifyLogoutBtn">Logout</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Storage Tab -->
        <div class="settings-section" id="tab-storage" style="display: none;">
          <h3>Cache Manager</h3>
          <p class="settings-description">Manage cached songs, lyrics, and images</p>

          <div class="cache-header">
            <div class="cache-stats" id="cacheStats">
              <span id="cacheStatsText">Loading...</span>
            </div>
            <button class="btn-danger" id="cacheClearAllBtn">Clear All</button>
          </div>

          <div class="cache-list" id="cacheList">
          </div>
        </div>

        <!-- Appearance Tab -->
        <div class="settings-section" id="tab-appearance" style="display: none;">
          <h3>Visible Sections</h3>
          <p class="settings-description">Choose which sections to display in the widget</p>

          <div class="visibility-actions">
            <button class="btn-danger" id="resetVisibilityBtn">Reset to Default</button>
          </div>

          <div class="settings-group">
            <label class="setting-row">
              <input type="checkbox" id="visibility-player" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Music Player</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-lyrics" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Lyrics</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-images" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Artist Images</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-info" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Artist Info</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-bio" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Biography</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-tracks" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Top Tracks</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-albums" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Top Albums</span>
              </div>
            </label>

            <label class="setting-row">
              <input type="checkbox" id="visibility-similar" checked>
              <span class="checkbox-custom"></span>
              <div class="setting-content">
                <span class="setting-label">Similar Artists</span>
              </div>
            </label>
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>

  <script src="./renderer.js"></script>
</body>
</html>